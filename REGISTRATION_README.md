# PinVibe User Registration System

## خلاصه
سیستم ثبت نام کاربران PinVibe با قابلیت‌های زیر پیاده‌سازی شده است:

✅ **تایید یکتا بودن نام کاربری و ایمیل**  
✅ **تایید ایمیل با کد امن**  
✅ **قوانین سختگیرانه رمز عبور**  
✅ **پیام‌های خطا به زبان فارسی**  
✅ **امکان ارسال مجدد ایمیل تایید**

## ویژگی‌های امنیتی

### 1. تایید یکتا بودن
- **نام کاربری**: فقط حروف، اعداد و خط زیر مجاز است
- **ایمیل**: فرمت معتبر و یکتا
- **اعتبارسنجی**: بررسی تکراری بودن در زمان ثبت نام

### 2. تایید ایمیل
- **توکن امن**: UUID تصادفی برای هر درخواست
- **انقضای خودکار**: توکن بعد از ۱ ساعت منقضی می‌شود
- **حساب غیرفعال**: کاربران تا تایید ایمیل نمی‌توانند وارد شوند
- **ارسال مجدد**: امکان ارسال مجدد ایمیل با محدودیت زمانی

### 3. قوانین رمز عبور
رمز عبور باید شامل موارد زیر باشد:
- حداقل ۸ کاراکتر
- حداقل یک حرف بزرگ (A-Z)
- حداقل یک حرف کوچک (a-z)
- حداقل یک عدد (0-9)
- حداقل یک کاراکتر خاص (!@#$%^&*(),.?":{}|<>)
- عدم تکرار متوالی کاراکترها
- عدم استفاده از الگوهای ساده

## نحوه استفاده

### 1. ثبت نام کاربر جدید
```bash
curl -X POST http://localhost:8000/api/users/register/ \
  -H "Content-Type: application/json" \
  -d '{
    "username": "user123",
    "email": "user@example.com",
    "password": "StrongPass123!",
    "password_confirm": "StrongPass123!"
  }'
```

### 2. ورود به سیستم
```bash
curl -X POST http://localhost:8000/api/users/login/ \
  -H "Content-Type: application/json" \
  -d '{
    "username": "user123",
    "password": "StrongPass123!"
  }'
```

### 3. تایید ایمیل
```bash
curl -X GET http://localhost:8000/api/users/verify-email/{TOKEN}/
```

### 4. ارسال مجدد ایمیل تایید
```bash
curl -X POST http://localhost:8000/api/users/resend-verification/ \
  -H "Content-Type: application/json" \
  -d '{"email": "user@example.com"}'
```

## پیام‌های خطا (فارسی)

| خطا | پیام |
|-----|------|
| نام کاربری تکراری | `این نام کاربری قبلاً استفاده شده است.` |
| ایمیل تکراری | `این ایمیل قبلاً استفاده شده است.` |
| رمز عبور ضعیف | `رمز عبور باید حداقل ۸ کاراکتر باشد.` |
| عدم تطابق رمز | `رمزهای عبور مطابقت ندارند.` |
| ایمیل تایید نشده | `ایمیل شما تایید نشده است.` |
| توکن منقضی شده | `کد تایید منقضی شده است.` |

## فایل‌های اضافه شده

### مدل‌ها
- `users/models.py` - مدل کاربر با فیلدهای تایید ایمیل

### سریالایزرها
- `users/serializers.py` - اعتبارسنجی و سریالایز کردن داده‌ها

### ویوها
- `users/views.py` - API endpoints برای ثبت نام و تایید

### ابزارها
- `users/validators.py` - اعتبارسنجی رمز عبور
- `users/utils.py` - توابع ارسال و تایید ایمیل

### قالب‌ها
- `templates/users/email_verification.html` - قالب HTML ایمیل
- `templates/users/email_verification.txt` - قالب متنی ایمیل
- `templates/users/email_verification_success.html` - صفحه موفقیت

### تست‌ها
- `users/test_registration.py` - تست‌های سیستم ثبت نام

## نصب و راه‌اندازی

### 1. نصب وابستگی‌ها
```bash
pip install django-cors-headers django-email-verification
```

### 2. تنظیمات ایمیل
در فایل `settings.py`:
```python
EMAIL_HOST_USER = 'your-email@gmail.com'
EMAIL_HOST_PASSWORD = 'your-app-password'
```

### 3. اجرای مایگریشن‌ها
```bash
python manage.py makemigrations users
python manage.py migrate
```

### 4. تست سیستم
```bash
python manage.py test users.test_registration
```

## مثال‌های رمز عبور

### رمزهای معتبر ✅
- `TestPass123!`
- `MySecure@2024`
- `Complex#Password1`

### رمزهای نامعتبر ❌
- `password` (بدون حرف بزرگ، عدد و کاراکتر خاص)
- `Password1` (بدون کاراکتر خاص)
- `Test123` (کوتاه)
- `aaa123!` (تکرار متوالی)

## جریان کار ثبت نام

1. **ثبت نام**: کاربر اطلاعات معتبر وارد می‌کند
2. **ارسال ایمیل**: ایمیل تایید به صورت خودکار ارسال می‌شود
3. **تولید توکن**: UUID منحصر به فرد تولید می‌شود
4. **انقضای توکن**: توکن بعد از ۱ ساعت منقضی می‌شود
5. **تایید**: کاربر روی لینک کلیک می‌کند یا از API استفاده می‌کند
6. **فعال‌سازی**: حساب کاربری فعال و تایید می‌شود

## نکات امنیتی

- **هش کردن رمز**: رمزها با الگوریتم امن Django هش می‌شوند
- **توکن‌های امن**: UUID تصادفی برای هر درخواست
- **قفل حساب**: حساب‌های تایید نشده قفل هستند
- **محدودیت زمانی**: ارسال مجدد ایمیل با محدودیت ۵ دقیقه
- **اعتبارسنجی کامل**: بررسی تمام ورودی‌ها

## پشتیبانی

برای سوالات و مشکلات:
1. فایل `API_DOCUMENTATION.md` را مطالعه کنید
2. تست‌ها را اجرا کنید: `python manage.py test users.test_registration`
3. مثال استفاده را ببینید: `python example_usage.py`

---

**توسعه‌دهنده**: تیم PinVibe  
**تاریخ**: ۲۰۲۴  
**نسخه**: 1.0 